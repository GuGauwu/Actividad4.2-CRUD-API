<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Videojuegos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #ffffff;
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2ecc71;
        }

        .form-container {
            background-color: #2a2a40;
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
            margin: 0 auto 20px;
        }

        input[type="text"], input[type="number"], .form-control {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            background-color: white !important;
            border: 1px solid #555;
            border-radius: 5px;
            color: black !important;
        }

        button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-save {
            background-color: #2ecc71;
            color: white;
        }

        .btn-cancel {
            background-color: #7f8c8d;
            color: white;
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }

        .btn-edit {
            background-color: #f1c40f;
            color: black;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #2a2a40;
        }

        .table th, .table td {
            padding: 12px;
            border: 1px solid #444;
            text-align: center;
        }

        .table th {
            background-color: #333;
        }

        .search-bar {
            width: 100%;
            padding: 10px;
            background-color: white !important;
            border: 1px solid #555;
            border-radius: 5px;
            color: black !important;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="text-center mb-4">videojuegos</h1>

    <div class="card p-4 mb-4">
        <h5>Agregar / Editar videojuego</h5>
        <input type="text" id="titulo" class="form-control mb-2" placeholder="T√≠tulo">
        <input type="text" id="consola" class="form-control mb-2" placeholder="Consola">
        <input type="number" id="precio" class="form-control mb-2" placeholder="Precio">
        <input type="number" id="stock" class="form-control mb-2" placeholder="Stock">
        <button class="btn btn-success me-2" onclick="guardarVideojuego()">Guardar</button>
        <button class="btn btn-secondary" onclick="limpiarFormulario()">Cancelar</button>
    </div>

    <div class="mb-3">
        <input type="text" id="busqueda" class="form-control" placeholder="Buscar por t√≠tulo o consola" oninput="buscarVideojuego()">
        <button class="btn btn-light mt-2" onclick="limpiarBusqueda()">Limpiar b√∫squeda</button>
    </div>

    <table class="table table-dark table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>T√≠tulo</th>
                <th>Consola</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="videojuegos"></tbody>
    </table>
</div>

<script>
    const API = "http://127.0.0.1:8000/videojuegos/";
    let idEnEdicion = null;

    async function guardarVideojuego() {
        const titulo = document.getElementById("titulo").value;
        const consola = document.getElementById("consola").value;
        const precio = parseFloat(document.getElementById("precio").value);
        const stock = parseInt(document.getElementById("stock").value);

        const datos = { titulo, consola, precio, stock };

        const metodo = idEnEdicion ? "PUT" : "POST";
        const url = idEnEdicion ? API + idEnEdicion : API;

        const response = await fetch(url, {
            method: metodo,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datos),
        });

        if (response.ok) {
            alert(idEnEdicion ? "Videojuego actualizado" : "Videojuego guardado correctamente");
            limpiarFormulario();
            cargarVideojuegos();
        } else {
            alert("Error al guardar o actualizar el videojuego.");
        }
    }

    async function cargarVideojuegos() {
        const response = await fetch(API);
        const juegos = await response.json();
        mostrarJuegos(juegos);
    }

    function mostrarJuegos(juegos) {
        const contenedor = document.getElementById("videojuegos");
        contenedor.innerHTML = "";
        juegos.forEach(juego => {
            const fila = document.createElement("tr");
            fila.innerHTML = `
                <td>${juego.id}</td>
                <td>${juego.titulo}</td>
                <td>${juego.consola}</td>
                <td>$${juego.precio}</td>
                <td>${juego.stock}</td>
                <td>
                    <button class="btn btn-sm btn-warning me-1" onclick="editar(${juego.id})">‚úèÔ∏è</button>
                    <button class="btn btn-sm btn-danger" onclick="eliminar(${juego.id})">üóëÔ∏è</button>
                </td>
            `;
            contenedor.appendChild(fila);
        });
    }

    function limpiarFormulario() {
        document.getElementById("titulo").value = "";
        document.getElementById("consola").value = "";
        document.getElementById("precio").value = "";
        document.getElementById("stock").value = "";
        idEnEdicion = null;
    }

    async function eliminar(id) {
        if (!confirm("¬øEst√°s seguro de eliminar este videojuego?")) return;
        const response = await fetch(API + id, { method: "DELETE" });
        if (response.ok) {
            alert("Videojuego eliminado");
            cargarVideojuegos();
        }
    }

    function buscarVideojuego() {
        const filtro = document.getElementById("busqueda").value.toLowerCase();
        const filas = document.querySelectorAll("#videojuegos tr");

        filas.forEach(fila => {
            const titulo = fila.children[1].textContent.toLowerCase();
            const consola = fila.children[2].textContent.toLowerCase();
            fila.style.display = (titulo.includes(filtro) || consola.includes(filtro)) ? "" : "none";
        });
    }

    function limpiarBusqueda() {
        document.getElementById("busqueda").value = "";
        buscarVideojuego();
    }

    function editar(id) {
        fetch(API + id)
            .then(response => response.json())
            .then(data => {
                document.getElementById("titulo").value = data.titulo;
                document.getElementById("consola").value = data.consola;
                document.getElementById("precio").value = data.precio;
                document.getElementById("stock").value = data.stock;
                idEnEdicion = id;
            });
    }

    cargarVideojuegos();
</script>
</body>
</html>
